{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport { Als_GameData } from \"../common/GameData\";\r\nimport { PlayerDataManager_Als } from \"../common/GameDataManager\";\r\nimport { MiniManeger_Als } from \"../minigame/MiniManeger\";\r\nimport PlatformDY from \"../../PlatformDY\";\r\nimport InviteManager_Als from \"./InviteManager\";\r\nimport ConfigManager_Als from \"../games/ConfigManager\";\r\nimport ViewChangeManager_Als from \"../games/ViewChangeManager\";\r\nimport GameStateManager_Als from \"../games/GameStateManager\";\r\nimport { EnterGameType } from \"../games/CommonDefine\";\r\nimport { LevelManager_Als } from \"./LevelManager\";\r\nimport Als_SoundManager from \"../common/SoundManager\";\r\nimport AddPsView_Als from \"../views/game/Als_PopView/AddPsView\";\r\nimport SMGIView from \"../views/game/WeCatAls/ShouMoreGameInView\";\r\nimport MoreGameOperRequestTemp_Als from \"../views/game/MoreGameOperRequestTemp\";\r\nvar GameCenterManager_Als = (function () {\r\n    function GameCenterManager_Als() {\r\n    }\r\n    GameCenterManager_Als.getInstance = function () {\r\n        if (!GameCenterManager_Als.ins)\r\n            GameCenterManager_Als.ins = new GameCenterManager_Als();\r\n        return GameCenterManager_Als.ins;\r\n    };\r\n    GameCenterManager_Als.prototype.oppenAddSpView = function () {\r\n        var _this = this;\r\n        TipsManager.getInstance().showDefaultTips(\"体力不足\");\r\n        ViewChangeManager_Als.getInstance().showBufferLoadingView();\r\n        ResUtil.getIntance().loadGroups([\"adsp\"], function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                ViewManager.getInstance().showView(AddPsView_Als);\r\n                ViewChangeManager_Als.getInstance().hideBufferLoadingView();\r\n                return [2];\r\n            });\r\n        }); });\r\n    };\r\n    GameCenterManager_Als.prototype.GameCenterGotoGame_als = function (stData, fail) {\r\n        if (BaseConst.infos.gameInfo.isDY) {\r\n            PlatformDY.clickGame(stData.ad_id);\r\n        }\r\n        var self = this;\r\n        var data = {\r\n            appId: stData.ad_appid,\r\n            path: stData.url,\r\n            success: function () {\r\n                console.log(\"navigateToMiniProgram success!\");\r\n                if (BaseConst.infos.gameInfo.isDY) {\r\n                    PlatformDY.toGame(stData.ad_id);\r\n                }\r\n            },\r\n            fail: fail\r\n        };\r\n        platform.navigateToMiniProgram(data);\r\n    };\r\n    GameCenterManager_Als.prototype.getRandomIndex_num_alt = function (nNum) {\r\n        if (Als_GameData.getInstance().weCatMiniIconsInfo.length - 1 < 0) {\r\n            return [];\r\n        }\r\n        var nRandom = Utils.random(0, Als_GameData.getInstance().weCatMiniIconsInfo.length - 1);\r\n        var nCount = nNum;\r\n        var aryInfo = [];\r\n        for (var i = 0; i < nCount; ++i) {\r\n            aryInfo.push(nRandom);\r\n            nRandom += 1;\r\n            if (nRandom >= Als_GameData.getInstance().weCatMiniIconsInfo.length) {\r\n                nRandom = 0;\r\n            }\r\n        }\r\n        return aryInfo;\r\n    };\r\n    GameCenterManager_Als.prototype.refreshGameList_Als = function () {\r\n        if (BaseConst.infos.gameInfo.isDY && DeviceUtil.isWXMiniGame()) {\r\n            PlatformDY.refreshGameList();\r\n        }\r\n    };\r\n    GameCenterManager_Als.prototype.showMoreGameinView_als = function (bAni) {\r\n        if (bAni === void 0) { bAni = true; }\r\n        if (!this.pSMGInView) {\r\n            this.pSMGInView = new SMGIView();\r\n        }\r\n        else {\r\n            this.pSMGInView.refreshWCMG_Als();\r\n        }\r\n        this.pSMGInView.ani = bAni;\r\n        return this.pSMGInView;\r\n    };\r\n    GameCenterManager_Als.prototype.platformLogin_Als = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res_1, self_1, enter;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(DeviceUtil.isQQMiniGame() || DeviceUtil.isWXMiniGame() || DeviceUtil.isTTMiniGame())) return [3, 5];\r\n                        console.log(\"开始登录\");\r\n                        self_1 = this;\r\n                        enter = function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n                            return tslib_1.__generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0:\r\n                                        if (!BaseConst.infos.gameInfo.isDY) return [3, 2];\r\n                                        return [4, self_1.loginWeCatDy(res_1)];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        _a.label = 2;\r\n                                    case 2: return [2];\r\n                                }\r\n                            });\r\n                        }); };\r\n                        if (!(BaseConst.infos.gameInfo.isDY && DeviceUtil.isWXMiniGame())) return [3, 2];\r\n                        return [4, platform.DYlogin()];\r\n                    case 1:\r\n                        res_1 = _a.sent();\r\n                        return [3, 4];\r\n                    case 2: return [4, platform.login()];\r\n                    case 3:\r\n                        res_1 = _a.sent();\r\n                        res_1 = JSON.parse(res_1);\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        enter();\r\n                        return [3, 6];\r\n                    case 5:\r\n                        Als_GameData.getInstance().userInfo.openId = Als_GameData.getInstance().userInfo.sessionKey = DeviceUtil.getDeviceNo();\r\n                        PlayerDataManager_Als.getInstance().GetData();\r\n                        _a.label = 6;\r\n                    case 6: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GameCenterManager_Als.prototype.loginWeCatDy = function (stRes) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, isAuthorize, userinfo, obj, scene;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        res = stRes;\r\n                        return [4, platform.checkIsAuthorize()];\r\n                    case 1:\r\n                        isAuthorize = _a.sent();\r\n                        userinfo = null;\r\n                        if (!isAuthorize) return [3, 3];\r\n                        return [4, MiniManeger_Als.instance.initUserTemp()];\r\n                    case 2:\r\n                        userinfo = _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (userinfo == null) {\r\n                            userinfo = { nickName: '', avatarUrl: '', gender: '' };\r\n                        }\r\n                        obj = Als_GameData.getInstance().enterGameInfo;\r\n                        scene = obj.query.scene == undefined ? null : obj.query.scene;\r\n                        PlatformDY.getOpenidAndAuthorzia({\r\n                            code: res, nickName: userinfo.nickName, avatarUrl: userinfo.avatarUrl, gender: userinfo.gender, scene: decodeURIComponent(scene)\r\n                        }).then(function (dyUser) {\r\n                            Als_GameData.getInstance().userInfo.openId = dyUser.openid;\r\n                            Als_GameData.getInstance().strOpenIDWx = dyUser.openid;\r\n                            console.log(\"GameData.getInstance().strOpenIDWx = \", Als_GameData.getInstance().strOpenIDWx);\r\n                            var strOpenIdOther = Als_GameData.getInstance().enterGameInfo.query[\"openid\"];\r\n                            console.log(\"strOpenIdOther = \", strOpenIdOther);\r\n                            if (strOpenIdOther && strOpenIdOther != \"\") {\r\n                                InviteManager_Als.getInstance().judgeInvite();\r\n                                console.log(\"createUserInfoButton 用户信息 : \", Als_GameData.getInstance().userInfo);\r\n                            }\r\n                            if (BaseConst.infos.gameInfo.isDY) {\r\n                                PlatformDY.refreshGameList();\r\n                            }\r\n                            PlayerDataManager_Als.getInstance().GetData();\r\n                        });\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GameCenterManager_Als.prototype.loadRes_Als = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var loadresUrl, group, alsInstance;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.platformLogin_Als()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        console.log(\"loadRes---\");\r\n                        loadresUrl = \"\";\r\n                        return [4, ResUtil.getIntance().loadThms(loadresUrl + \"resource/default.thm.json\" + Als_GameData.getInstance().randomTime)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4, ResUtil.getIntance().loadRESConfig(loadresUrl + \"resource/default.res.json\" + Als_GameData.getInstance().randomTime)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.loadLayOutInfo();\r\n                        group = [\"panel\", \"common\", \"gamehome\"];\r\n                        alsInstance = PlayerDataManager_Als.getInstance();\r\n                        group.push(alsInstance.getCurLevelToChallenge().toString());\r\n                        ResUtil.getIntance().loadGroups(group, function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n                            return tslib_1.__generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, ConfigManager_Als.getInstance().initConfigInfo()];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        this.enterGame();\r\n                                        this.onPlayMusic_Als();\r\n                                        ResUtil.getIntance().loadGroups([\"lottery\", 'success', 'game', 'hit', 'moregame']);\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        }); }, function (cur, total) {\r\n                            _this.pLoadingView.progress(cur, total);\r\n                        });\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GameCenterManager_Als.prototype.enterGame = function () {\r\n        var alsInstance = PlayerDataManager_Als.getInstance();\r\n        alsInstance.initGoods();\r\n        alsInstance.refreshOffLinePS();\r\n        ViewChangeManager_Als.getInstance().rigestBufferLoadingView();\r\n        if (!alsInstance.isNewPlayer) {\r\n            GameStateManager_Als.getInstance().levelState = EnterGameType.enum_EnterGameType_GameHome;\r\n        }\r\n        else {\r\n            GameStateManager_Als.getInstance().levelState = EnterGameType.enum_EnterGameType_ChooseLevel;\r\n            alsInstance.SaveData();\r\n        }\r\n        alsInstance.setCurLevel(alsInstance.getLevelToChangeMaxLevel() - 1);\r\n        LevelManager_Als.getInstance().createLevelScene(alsInstance.getLevelToChangeMaxLevel());\r\n        ViewChangeManager_Als.getInstance().showCommonView();\r\n        ViewChangeManager_Als.getInstance().showImageExit();\r\n        ViewChangeManager_Als.bGameOpen = true;\r\n    };\r\n    GameCenterManager_Als.prototype.onPlayMusic_Als = function () {\r\n        Als_SoundManager.getInstance().bgm = 'bg';\r\n        Laya.stage.off(Laya.Event.CLICK, this, this.onPlayMusic_Als);\r\n    };\r\n    GameCenterManager_Als.prototype.loadLayOutInfo = function () {\r\n        var resUrl = \"\";\r\n    };\r\n    GameCenterManager_Als.prototype.initMoreGame = function (res, resUrl) {\r\n        var infos = [];\r\n        for (var i = 0, len = res.iconList.length; i < len; i++) {\r\n            res.iconList[i].ad_img = \"https://package.32yx.com/ecy_game_small/laya/girl/tt/moregame/\" + res.iconList[i].ad_img;\r\n        }\r\n        Als_GameData.getInstance().weCatMiniIconsInfo = res.iconList;\r\n    };\r\n    GameCenterManager_Als.prototype.gotoGame = function (stGameIndex, stScene) {\r\n        if (stScene === void 0) { stScene = null; }\r\n        if (BaseConst.infos.gameInfo.isDY) {\r\n            PlatformDY.clickGame(stGameIndex.ad_id);\r\n        }\r\n        var self = this;\r\n        var data = {\r\n            appId: stGameIndex.ad_appid,\r\n            path: stGameIndex.url,\r\n            success: function () {\r\n                console.log(\"navigateToMiniProgram success\");\r\n                if (BaseConst.infos.gameInfo.isDY) {\r\n                    console.log(\"self.nIndex = \", stGameIndex.ad_id);\r\n                    PlatformDY.toGame(stGameIndex.ad_id);\r\n                }\r\n            },\r\n            fail: function (e) {\r\n                console.log(\"navigateToMiniProgram fail e =\", e);\r\n                if (stScene) {\r\n                    ViewManager.getInstance().showView(stScene);\r\n                }\r\n            }\r\n        };\r\n        platform.navigateToMiniProgram(data);\r\n    };\r\n    GameCenterManager_Als.prototype.getRandomIndex = function (nMax) {\r\n        if (Als_GameData.getInstance().weCatMiniIconsInfo.length - 1 < 0) {\r\n            return [];\r\n        }\r\n        var nRandom = Utils.random(0, Als_GameData.getInstance().weCatMiniIconsInfo.length - 1);\r\n        var nCount = Als_GameData.getInstance().weCatMiniIconsInfo.length % 3;\r\n        if (nCount > 0) {\r\n            nCount = 3 - nCount;\r\n        }\r\n        nCount = Als_GameData.getInstance().weCatMiniIconsInfo.length + nCount;\r\n        if (nCount <= nMax) {\r\n            nCount = nMax;\r\n        }\r\n        var aryInfo = [];\r\n        for (var i = 0; i < nCount; ++i) {\r\n            aryInfo.push(nRandom);\r\n            nRandom += 1;\r\n            if (nRandom >= Als_GameData.getInstance().weCatMiniIconsInfo.length) {\r\n                nRandom = 0;\r\n            }\r\n        }\r\n        return aryInfo;\r\n    };\r\n    GameCenterManager_Als.prototype.toGameRandom = function () {\r\n        if (Als_GameData.getInstance().weCatMiniIconsInfo.length <= 0) {\r\n            return;\r\n        }\r\n        var nRandomIndxe = Utils.random(0, Als_GameData.getInstance().weCatMiniIconsInfo.length - 1);\r\n        if (BaseConst.infos.gameInfo.isDY) {\r\n            PlatformDY.clickGame(Als_GameData.getInstance().weCatMiniIconsInfo[nRandomIndxe].ad_id);\r\n        }\r\n        var self = this;\r\n        var data = {\r\n            appId: Als_GameData.getInstance().weCatMiniIconsInfo[nRandomIndxe].ad_appid,\r\n            path: Als_GameData.getInstance().weCatMiniIconsInfo[nRandomIndxe].url,\r\n            success: function () {\r\n                console.log(\"navigateToMiniProgram success\");\r\n                if (BaseConst.infos.gameInfo.isDY) {\r\n                    console.log(\"self.nIndex = \", nRandomIndxe);\r\n                    PlatformDY.toGame(Als_GameData.getInstance().weCatMiniIconsInfo[nRandomIndxe].ad_id);\r\n                }\r\n            },\r\n            fail: function (e) {\r\n                console.log(\"navigateToMiniProgram fail e =\", e);\r\n                ViewManager.getInstance().showView(MoreGameOperRequestTemp_Als);\r\n            }\r\n        };\r\n        platform.navigateToMiniProgram(data);\r\n    };\r\n    GameCenterManager_Als.prototype.toGameRandomNotOpenView = function () {\r\n        var self = this;\r\n        var aryCatMiniIconsInfoTemp = Als_GameData.getInstance().weCatMiniIconsInfo;\r\n        if (aryCatMiniIconsInfoTemp.length <= 0) {\r\n            return;\r\n        }\r\n        var nRandomIndxe = Utils.random(0, aryCatMiniIconsInfoTemp.length - 1);\r\n        if (BaseConst.infos.gameInfo.isDY) {\r\n            PlatformDY.clickGame(aryCatMiniIconsInfoTemp[nRandomIndxe].ad_id);\r\n        }\r\n        var idata = aryCatMiniIconsInfoTemp[nRandomIndxe];\r\n        var data = {\r\n            appId: idata.ad_appid,\r\n            path: idata.url,\r\n            success: function () {\r\n                console.log(\"navigateToMiniProgram success\");\r\n                if (BaseConst.infos.gameInfo.isDY) {\r\n                    console.log(\"self.nIndex = \", nRandomIndxe);\r\n                    PlatformDY.toGame(idata.ad_id);\r\n                }\r\n            },\r\n            fail: function (e) {\r\n                console.log(\"navigateToMiniProgram fail e =\", e);\r\n            }\r\n        };\r\n        platform.navigateToMiniProgram(data);\r\n    };\r\n    return GameCenterManager_Als;\r\n}());\r\nexport default GameCenterManager_Als;\r\n",
  "references": [
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/common/GameData.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/common/GameDataManager.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/minigame/MiniManeger.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/PlatformDY.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/manager/InviteManager.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/games/ConfigManager.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/games/ViewChangeManager.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/games/GameStateManager.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/games/CommonDefine.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/manager/LevelManager.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/loading/GamePreLoadingView.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/common/SoundManager.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/views/game/Als_PopView/AddPsView.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/views/game/moregame/MoreGameView.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/views/game/WeCatAls/ShouMoreGameInView.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/views/game/MoreGameOperRequestTemp.ts",
    "E:/laya/project/laya_girl_ts_wecat_git/src/script/views/game/MoreGameOperRequest.ts"
  ]
}
